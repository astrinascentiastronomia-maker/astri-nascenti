<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>ASTRI NASCENTI — Book 2025</title>

<style>
:root{
  --max-book-width: 420px;
  --turn-duration: 700ms;
  --pages: 36;
}

html,body{
  height:100%;
  margin:0;
  background:#0b0b0b;
  color:#fff;
  font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial;
}

.wrap{
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:20px;
}

.book{
  width:100%;
  max-width:var(--max-book-width);
  height:85vh;
  position:relative;
  perspective:1400px;
}

/* mostra solo la pagina destra */
.page-viewport{
  position:relative;
  width:50%;
  height:100%;
  overflow:hidden;
  background:#111;
  box-shadow:0 20px 50px rgba(0,0,0,.8);
  border-radius:8px;
  margin-left:auto;
}

/* livelli */
.layer{
  position:absolute;
  inset:0;
  backface-visibility:hidden;
  transform-style:preserve-3d;
}

.layer img{
  width:200%;
  height:100%;
  object-fit:cover;
  transform:translateX(-50%);
  user-select:none;
  -webkit-user-drag:none;
}

/* pagina che gira */
.flipper{
  transform-origin:left center;
  transition:transform var(--turn-duration) ease-in-out;
  z-index:10;
}

.flipper.turn{
  transform:rotateY(-180deg);
}

.flipper .back{
  position:absolute;
  inset:0;
  transform:rotateY(180deg);
}

/* controlli */
.controls{
  position:absolute;
  left:0;
  bottom:10px;
  display:flex;
  gap:10px;
  align-items:center;
  z-index:20;
}

.btn{
  background:rgba(255,255,255,.08);
  border:1px solid rgba(255,255,255,.15);
  color:#fff;
  padding:8px 14px;
  border-radius:8px;
  cursor:pointer;
  font-size:14px;
}

.status{
  font-size:13px;
  opacity:.85;
}

.hint{
  position:absolute;
  top:10px;
  left:10px;
  font-size:13px;
  opacity:.8;
}
</style>
</head>

<body>

<div class="wrap">
  <div class="book">

    <div class="page-viewport" id="viewport">

      <!-- PAGINA SUCCESSIVA (SOTTO) -->
      <div class="layer">
        <img id="nextImg" alt="pagina successiva">
      </div>

      <!-- PAGINA CHE SI SFOGLIA -->
      <div class="layer flipper" id="flipper">
        <img id="currentImg" alt="pagina corrente">
        <div class="back">
          <img id="backImg" alt="retro pagina">
        </div>
      </div>

    </div>

    <div class="controls">
      <button class="btn" id="prev">◀</button>
      <button class="btn" id="next">▶</button>
      <div class="status" id="status">1 / 36</div>
    </div>

    <div class="hint">Scorri o usa i pulsanti</div>

  </div>
</div>

<script>
/*
══════════════════════════════════════════════
 STRUTTURA FILE OBBLIGATORIA
══════════════════════════════════════════════

/book.html
/Pag/
  astri-nascenti-2025-1.jpg
  astri-nascenti-2025-2.jpg
  astri-nascenti-2025-3.jpg
  ...
  astri-nascenti-2025-36.jpg

══════════════════════════════════════════════
*/

(() => {

  const TOTAL_PAGES = 36;

  /* PERCORSO IMMAGINI */
  const PATH = 'Pag/astri-nascenti-2025-';
  const EXT  = '.jpg';

  const currentImg = document.getElementById('currentImg');
  const backImg    = document.getElementById('backImg');
  const nextImg    = document.getElementById('nextImg');
  const flipper    = document.getElementById('flipper');
  const status     = document.getElementById('status');
  const viewport   = document.getElementById('viewport');

  let page = 1;
  let busy = false;

  const src = n => `${PATH}${n}${EXT}`;

  function load(img, src){
    return new Promise(r=>{
      img.onload = img.onerror = r;
      img.src = src;
    });
  }

  function updateStatus(){
    status.textContent = `${page} / ${TOTAL_PAGES}`;
  }

  async function turn(to){
    if(busy || to < 1 || to > TOTAL_PAGES || to === page) return;
    busy = true;

    await load(currentImg, src(page));
    await load(backImg, src(to));
    await load(nextImg, src(to));

    flipper.classList.add('turn');

    setTimeout(async ()=>{
      flipper.classList.remove('turn');
      page = to;
      updateStatus();

      await load(currentImg, src(page));
      await load(backImg, src(page));
      await load(nextImg, src(Math.min(page+1, TOTAL_PAGES)));

      busy = false;
    }, 700);
  }

  document.getElementById('next').onclick = () => turn(page+1);
  document.getElementById('prev').onclick = () => turn(page-1);

  /* SWIPE MOBILE */
  let startX = 0;
  viewport.addEventListener('touchstart', e=>{
    startX = e.touches[0].clientX;
  }, {passive:true});

  viewport.addEventListener('touchend', e=>{
    const dx = e.changedTouches[0].clientX - startX;
    if(Math.abs(dx) > 40){
      dx < 0 ? turn(page+1) : turn(page-1);
    }
  }, {passive:true});

  /* AVVIO */
  (async ()=>{
    updateStatus();
    await load(currentImg, src(1));
    await load(backImg, src(1));
    await load(nextImg, src(2));
  })();

})();
</script>

</body>
</html>
